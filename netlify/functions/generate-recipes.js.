// netlify/functions/generate-recipes.js

exports.handler = async function (event, context) {
  // Выводим в лог Netlify, что функция была вызвана
  console.log("Function 'generate-recipes' was called.");
  console.log("Request body:", event.body);

  // Это тестовый ответ. Он не обращается к Google AI.
  const testResponse = {
    candidates: [
      {
        content: {
          parts: [
            {
              text: JSON.stringify([
                {
                  name: "Test Recipe",
                  description: "This is a test recipe to check if the function is working.",
                  time: "5 minutes",
                  ingredients: ["1x Test Ingredient", "1x Working Function"],
                  instructions: ["1. Open the site.", "2. See this recipe.", "3. Confirm it works!"]
                }
              ])
            }
          ]
        }
      }
    ]
  };

  try {
    // Отправляем успешный тестовый ответ
    return {
      statusCode: 200,
      headers: { 
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*' // Разрешаем запросы для теста
      },
      body: JSON.stringify(testResponse)
    };

  } catch (error) {
    // Если даже здесь произойдет ошибка, мы ее запишем в лог
    console.error("Error in test function:", error);
    return {
      statusCode: 500,
      body: JSON.stringify({ error: "Something went wrong in the test function." })
    };
  }
};
